# 🎯 智能Excel转换使用指南

## 📋 功能说明

我已经为您创建了智能Excel转换系统，可以**自动识别**您的Excel表格格式并转换为标准模板，然后完成冠脉评分计算。

## 🚀 三种使用方式

### 方式一：一键自动处理（推荐）

```bash
python 一键评分.py
```

**特点**：
- 🤖 自动查找Excel文件
- 🔍 智能识别表格格式  
- 📊 自动完成评分计算
- 📄 生成完整结果报告

### 方式二：智能格式转换

```bash
python 智能转换器.py
```

**特点**：
- 🧠 强大的"阅读理解"能力
- 🔄 支持多种列名格式
- 📝 生成标准格式文件
- ✅ 可选择是否立即评分

### 方式三：直接处理标准格式

```bash
python 处理我的Excel文件.py
```

**特点**：
- ⚡ 适合已经是标准格式的文件
- 📈 详细的统计报告
- 💾 自动生成结果文件

## 🧠 智能识别能力

### 支持的列名格式

| 标准字段 | 智能识别的列名（举例） |
|---------|---------------------|
| **患者ID** | 病例号、患者ID、住院号、门诊号、病历号、编号、序号 |
| **年龄** | 年龄、岁、age、years |
| **性别** | 性别、男女、gender、sex |
| **血管** | 血管、病变血管、靶血管、罪犯血管、主要病变血管 |
| **狭窄度** | 狭窄、狭窄度、狭窄百分比、狭窄程度、阻塞、堵塞 |
| **位置** | 位置、部位、节段、段、病变位置、狭窄位置 |
| **糖尿病** | 糖尿病、DM、血糖、合并糖尿病 |
| **高血压** | 高血压、HTN、血压、合并高血压 |
| **射血分数** | EF、射血分数、左室射血分数、心功能 |

### 智能数据处理

**血管名称标准化**：
- `左前降支近段` → `LAD` + `proximal`
- `左主干` → `LM` 
- `右冠脉中段` → `RCA` + `mid`
- `左回旋支远端` → `LCX` + `distal`

**狭窄程度提取**：
- `75%` → `75.0`
- `85%重度` → `85.0`
- `完全闭塞` → `100.0`
- `中度狭窄` → `70.0`

**性别标准化**：
- `男`、`男性`、`M` → `male`
- `女`、`女性`、`F` → `female`

**布尔值识别**：
- `是`、`有`、`TRUE`、`1`、`阳性` → `True`
- `否`、`无`、`FALSE`、`0`、`阴性` → `False`

## 📊 处理示例

### 您的复杂格式表格

| 病例号 | 患者年龄 | 性别 | 病变血管 | 狭窄程度 | 病变位置 | 合并糖尿病 |
|-------|---------|------|----------|----------|----------|-----------|
| 病例001 | 65 | 男 | 左前降支近段 | 75% | 近段 | 是 |
| 病例002 | 58 | 女 | 左回旋支 | 85%重度 | 近端 | 否 |

### ↓ 智能转换后 ↓

| patient_id | age | gender | vessel | stenosis_percent | location | diabetes |
|------------|-----|--------|--------|------------------|----------|----------|
| 病例001 | 65 | male | LAD | 75.0 | proximal | True |
| 病例002 | 58 | female | LCX | 85.0 | proximal | False |

### ↓ 评分结果 ↓

| patient_id | SYNTAX_score | SYNTAX_class | CAD_RADS_grade | Gensini_score |
|------------|--------------|--------------|----------------|---------------|
| 病例001 | 8.2 | Low | 4 | 10.0 |
| 病例002 | 7.2 | Low | 4 | 20.0 |

## 🎯 使用步骤

### 第一步：准备Excel文件

1. 将您的冠脉数据整理到Excel文件中
2. 确保包含关键信息：患者ID、年龄、性别、病变血管、狭窄程度
3. 列名可以使用中文或英文，系统会自动识别

### 第二步：运行处理程序

**最简单的方法**：
```bash
python 一键评分.py
```

选择"1. 自动查找并处理Excel文件"，系统会：
- 🔍 自动在当前目录查找Excel文件
- 🧠 智能分析您的表格格式
- 🔄 自动转换为标准格式
- 📊 计算SYNTAX、CAD-RADS、Gensini评分
- 💾 生成完整的结果报告

### 第三步：查看结果

系统会生成：
1. `您的文件名_冠脉评分结果.xlsx` - 完整的评分结果
2. 控制台显示详细的评分过程和统计摘要

## 📈 结果文件内容

最终的结果Excel文件包含：

| 列名 | 说明 |
|------|------|
| patient_id | 患者ID |
| age, gender | 基本信息 |
| vessel, location, stenosis_percent | 病变详情 |
| SYNTAX_score, SYNTAX_class | SYNTAX评分及风险分层 |
| CAD_RADS_grade | CAD-RADS分级 |
| Gensini_score, Gensini_class | Gensini评分及风险分层 |

## 🔧 故障排除

### 常见问题

**Q: 提示"未找到关键字段"怎么办？**
A: 系统会尝试用默认值填充，但建议检查列名是否包含关键词

**Q: 年龄字段识别失败？**
A: 确保年龄列名包含"年龄"、"岁"或"age"等关键词

**Q: 血管名称识别错误？**
A: 支持中英文混合，如"LAD"、"左前降支"、"前降支"等

**Q: 狭窄百分比提取不正确？**
A: 支持"75%"、"85%重度"、"中度狭窄"等多种格式

### 技术支持

如果遇到问题：
1. 检查Excel文件是否能正常打开
2. 确保至少包含患者标识和狭窄信息
3. 查看控制台的详细错误信息
4. 尝试简化列名（如"狭窄百分比"而不是复杂描述）

## 🎉 总结

现在您可以：
✅ **直接使用您现有的Excel格式**
✅ **无需手工转换格式**  
✅ **自动识别中英文列名**
✅ **智能提取关键信息**
✅ **一键完成评分计算**
✅ **获得专业评分报告**

只需要运行 `python 一键评分.py`，系统就会自动处理您的表格并给出冠脉评分结果！