# 单表格式Excel处理指南

## 概述

单表格式处理器专门为简单的Excel表格设计，一行代表一个患者的基本信息和主要病变信息。这种格式适合快速录入和批量处理冠脉病变评分。

## 文件列表

- `create_single_template.py` - 创建单表格式Excel模板
- `single_sheet_processor_v2.py` - 单表格式处理器（主程序）
- `data/single_sheet_template.xlsx` - Excel模板文件
- `data/single_sheet_results.xlsx` - 处理结果文件

## 使用步骤

### 1. 生成模板文件

```bash
python create_single_template.py
```

这会在 `data/` 目录下创建 `single_sheet_template.xlsx` 模板文件。

### 2. 准备您的数据

将您的患者数据按照模板格式填入Excel文件。

#### 必需字段（必须填写）：
- **patient_id**: 患者ID（文本）
- **age**: 年龄（数字）
- **gender**: 性别（male/female）
- **vessel**: 主要病变血管（LM/LAD/LCX/RCA/OM/D/PDA）
- **stenosis_percent**: 狭窄百分比（0-100）
- **location**: 病变位置（proximal/mid/distal）

#### 可选字段（可以留空）：
- **diabetes**: 糖尿病（TRUE/FALSE）
- **hypertension**: 高血压（TRUE/FALSE）
- **hyperlipidemia**: 高脂血症（TRUE/FALSE）
- **smoking**: 吸烟（TRUE/FALSE）
- **ejection_fraction**: 射血分数（数字，%）
- **creatinine_mg_dl**: 肌酐值（数字，mg/dL）
- **length_mm**: 病变长度（数字，mm）
- **is_bifurcation**: 分叉病变（TRUE/FALSE）
- **is_calcified**: 钙化病变（TRUE/FALSE）
- **is_ostial**: 开口病变（TRUE/FALSE）
- **is_tortuous**: 迂曲病变（TRUE/FALSE）
- **is_cto**: 慢性完全闭塞（TRUE/FALSE）
- **thrombus_present**: 血栓（TRUE/FALSE）
- **notes**: 备注信息（文本）

### 3. 处理数据

将您的Excel文件命名为 `single_sheet_template.xlsx` 并放在 `data/` 目录下，然后运行：

```bash
python single_sheet_processor_v2.py
```

或者修改程序中的文件路径来处理您自己的文件。

### 4. 查看结果

程序会：
1. 在屏幕上显示详细的处理过程和评分结果
2. 生成 `data/single_sheet_results.xlsx` 结果文件

## 示例数据

模板中包含4个示例患者：

| 患者ID | 年龄 | 性别 | 血管 | 狭窄% | 位置 | 特征 |
|--------|------|------|------|-------|------|------|
| P001 | 65 | 男 | LAD | 75% | 近段 | 分叉钙化病变 |
| P002 | 58 | 女 | LCX | 85% | 近段 | 分叉迂曲病变 |
| P003 | 72 | 男 | LM | 80% | 近段 | 左主干分叉钙化 |
| P004 | 45 | 男 | RCA | 60% | 中段 | 简单病变 |

## 评分结果说明

### SYNTAX评分
- **低风险** (≤22分): 适合PCI治疗
- **中等风险** (23-32分): PCI和CABG均可考虑
- **高风险** (≥33分): 优先考虑CABG治疗

### CAD-RADS分级
- **0级**: 无冠脉病变
- **1级**: 轻微病变 (1-24%)
- **2级**: 轻度病变 (25-49%)
- **3级**: 中度病变 (50-69%)
- **4级**: 重度病变 (70-99%)
- **5级**: 完全闭塞 (100%)

### Gensini评分
- **无病变** (0分): 正常
- **轻度** (1-20分): 轻度病变
- **中度** (21-40分): 中度病变
- **重度** (41-80分): 重度病变
- **极重度** (>80分): 极重度病变

## 注意事项

1. **数据格式**: 确保数值字段填入数字，布尔字段使用TRUE/FALSE
2. **血管名称**: 使用标准缩写（LM, LAD, LCX, RCA等）
3. **位置**: 使用英文（proximal, mid, distal）
4. **性别**: 使用英文（male, female）
5. **必需字段**: 必需字段不能为空，否则会处理失败

## 输出文件

结果文件包含原始数据和所有评分结果：
- 患者基本信息
- 病变详情
- SYNTAX评分及风险分层
- CAD-RADS分级
- Gensini评分及风险分层

## 故障排除

1. **文件不存在错误**: 确认Excel文件路径正确
2. **缺少必需列错误**: 检查列名是否与模板一致
3. **数据类型错误**: 确保数值字段填入数字而非文本
4. **编码问题**: 使用UTF-8编码保存文件

## 自定义处理

如需处理不同文件名或路径的Excel文件，可以修改 `single_sheet_processor_v2.py` 中的文件路径，或者创建新的脚本调用处理函数。

---

**注意**: 此工具仅供医学研究和教育使用，不能替代专业医学诊断。临床决策请咨询专业医师。